<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Unicorn Jumper â€” Polished</title>
<style>
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  body{background:linear-gradient(#bfeaff,#ffffff);overflow:hidden}
  canvas{display:block;width:100vw;height:100vh}
  .hud{position:fixed;left:12px;top:12px;background:rgba(0,0,0,.45);color:#fff;border-radius:10px;padding:8px 12px;font-size:14px;z-index:10}
  .hint{position:fixed;right:12px;top:12px;background:rgba(0,0,0,.45);color:#fff;border-radius:10px;padding:8px 12px;font-size:13px;z-index:10}
  .overlay{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(rgba(255,255,255,.85),rgba(255,255,255,.75));z-index:20}
  .card{background:#fff;border:1px solid #e7ecf3;border-radius:16px;max-width:520px;padding:22px;box-shadow:0 6px 28px rgba(0,0,0,.08);text-align:center}
  .btn{cursor:pointer;border:1px solid #111;background:#111;color:#fff;border-radius:12px;padding:12px 16px;font-weight:700}
</style>
</head>
<body>
<canvas id="cv"></canvas>
<div class="hud">Score: <span id="score">0</span></div>
<div class="hint">Tap/Space to jump â€¢ Hold for higher â€¢ Double-jump on</div>

<div class="overlay" id="startOv">
  <div class="card">
    <h2>ðŸ¦„ Unicorn Jumper</h2>
    <p>Collect rings, dodge fireballs. Tap/Space to jump.</p>
    <button class="btn" id="startBtn">Start</button>
  </div>
</div>

<div class="overlay" id="overOv" style="display:none">
  <div class="card">
    <h2>Game Over</h2>
    <p>Score: <span id="finalScore">0</span></p>
    <button class="btn" id="restartBtn">Restart</button>
  </div>
</div>

<script>
/* ---------------- SVG IMAGES (embedded) ---------------- */
const unicornSVG = `
<svg xmlns="http://www.w3.org/2000/svg" width="96" height="72" viewBox="0 0 96 72">
  <defs>
    <linearGradient id="horn" x1="0" x2="1">
      <stop offset="0" stop-color="#ffe08a"/>
      <stop offset="1" stop-color="#ffd166"/>
    </linearGradient>
  </defs>
  <!-- tail (rainbow) -->
  <path d="M20,52 C4,52 8,64 2,68" stroke="#ff7ad9" stroke-width="5" fill="none" stroke-linecap="round"/>
  <path d="M22,56 C8,56 10,66 6,70" stroke="#ffcc00" stroke-width="4" fill="none" stroke-linecap="round"/>
  <path d="M24,59 C12,59 14,68 12,71" stroke="#7afcff" stroke-width="3" fill="none" stroke-linecap="round"/>

  <!-- body -->
  <rect x="22" y="24" rx="12" ry="12" width="54" height="34" fill="#fff" stroke="#f3f3f3"/>
  <!-- legs -->
  <rect x="28" y="48" width="8" height="18" rx="4" fill="#f2f2f2"/>
  <rect x="40" y="48" width="8" height="18" rx="4" fill="#f2f2f2"/>
  <rect x="58" y="48" width="8" height="18" rx="4" fill="#f2f2f2"/>
  <rect x="70" y="48" width="8" height="18" rx="4" fill="#f2f2f2"/>

  <!-- head -->
  <rect x="64" y="14" rx="10" ry="10" width="22" height="22" fill="#fff" stroke="#f3f3f3"/>
  <!-- ear -->
  <path d="M78,14 84,10 80,20 Z" fill="#ffe3f4"/>
  <!-- horn -->
  <path d="M86,12 96,6 90,22 Z" fill="url(#horn)"/>
  <!-- mane -->
  <path d="M62,18 C56,22 58,30 62,34" stroke="#7a4bff" stroke-width="4" fill="none" stroke-linecap="round"/>
  <path d="M60,20 C54,24 56,32 60,36" stroke="#ff7ad9" stroke-width="4" fill="none" stroke-linecap="round"/>
  <path d="M58,22 C52,26 54,34 58,38" stroke="#7afcff" stroke-width="4" fill="none" stroke-linecap="round"/>

  <!-- eye -->
  <circle cx="79" cy="22" r="2.6" fill="#0b1020"/>
</svg>
`;

const fireballSVG = `
<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44">
  <defs>
    <radialGradient id="g" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#ffbc7a" stop-opacity="1"/>
      <stop offset="100%" stop-color="#ff7a59" stop-opacity="0"/>
    </radialGradient>
  </defs>
  <circle cx="22" cy="22" r="18" fill="url(#g)"/>
  <circle cx="22" cy="22" r="12" fill="#ff4b4b"/>
  <path d="M4,22 C2,17 8,14 14,12 C9,9 9,7 12,5 C15,3 21,5 24,8 C28,4 33,6 35,9 C37,12 36,16 33,19 C31,22 29,24 26,26" fill="#ff7a59"/>
</svg>
`;

const ringSVG = `
<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44">
  <defs>
    <linearGradient id="rg" x1="0" x2="1">
      <stop offset="0" stop-color="#ffe680"/>
      <stop offset="1" stop-color="#ffbf00"/>
    </linearGradient>
  </defs>
  <circle cx="22" cy="22" r="16" stroke="url(#rg)" stroke-width="8" fill="none"/>
  <circle cx="16" cy="16" r="6" stroke="#fff" stroke-opacity=".6" stroke-width="2" fill="none"/>
</svg>
`;

const cloudSVG = `
<svg xmlns="http://www.w3.org/2000/svg" width="180" height="90" viewBox="0 0 180 90">
  <g fill="#fff">
    <circle cx="64" cy="56" r="28"/>
    <circle cx="92" cy="52" r="24"/>
    <circle cx="50" cy="52" r="22"/>
    <rect x="24" y="58" width="96" height="20" rx="10" ry="10"/>
  </g>
</svg>
`;

/* ------------- helpers to create images from SVG ------------- */
function svgToImg(svg) {
  return new Promise((resolve) => {
    const img = new Image();
    img.src = 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg);
    img.onload = () => resolve(img);
  });
}

/* ---------------------- game setup ---------------------- */
const cv = document.getElementById('cv');
const ctx = cv.getContext('2d');
const scoreEl = document.getElementById('score');
const startOv = document.getElementById('startOv');
const overOv = document.getElementById('overOv');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const finalScoreEl = document.getElementById('finalScore');

function resize(){ cv.width = innerWidth; cv.height = innerHeight; }
addEventListener('resize', resize); resize();

let unicornImg, fireImg, ringImg, cloudImg;

let state = 'start';
let score = 0;

const player = {
  x: 80, y: cv.height-160, w: 96, h: 72,
  vy: 0, gravity: 0.9, jump: -22,
  grounded: false, canDouble: true,
  coyoteMs: 120, bufferMs: 140, coyote: 0, buffer: 0
};
let holdingJump = false;

const rings = [];
const fires = [];
const clouds = [];
const platforms = []; // cloud platforms that you can land on

/* ------------- input ------------- */
addEventListener('keydown', (e)=>{
  if(e.code==='Space'){ holdingJump = true; queueJump(); }
  if(state==='over' && (e.code==='Space'||e.code==='KeyR')) location.reload();
});
addEventListener('keyup', (e)=>{
  if(e.code==='Space'){ holdingJump = false; }
});
addEventListener('touchstart', (e)=>{
  e.preventDefault();
  if(state==='over'){ location.reload(); return; }
  holdingJump = true; queueJump();
},{passive:false});
addEventListener('touchend', (e)=>{ e.preventDefault(); holdingJump = false; }, {passive:false});

function queueJump(){ player.buffer = player.bufferMs; }

/* ------------- spawners ------------- */
let tRing=0, tFire=0, tDiff=0, speedScale=1;

function spawnRing(){
  // 30â€“70% height; occasionally a higher one over a platform
  const high = Math.random()<0.25;
  const y = high ? (cv.height*0.28) : (Math.random()*(cv.height*0.4)+cv.height*0.3);
  rings.push({x: cv.width+60, y, r: 20, s: 3.6*speedScale});
  // if high, ensure a platform appears shortly before it
  if(high){
    platforms.push({
      x: cv.width+20, y: y+40, w: 140, h: 18, s: 2.4*speedScale
    });
  }
}
function spawnFire(){
  const y = Math.random()*(cv.height*0.5)+cv.height*0.25;
  fires.push({x: cv.width+60, y, r: 18, s: 5.0*speedScale, t: Math.random()*1000});
}
function spawnCloudBg(){
  clouds.push({x: Math.random()*cv.width, y: Math.random()*cv.height*0.45+cv.height*0.1, s: 0.3+Math.random()*0.6});
}
for(let i=0;i<8;i++) spawnCloudBg();

/* ------------- collisions ------------- */
function rectCircle(rx,ry,rw,rh,cx,cy,cr){
  const tx = Math.max(rx, Math.min(cx, rx+rw));
  const ty = Math.max(ry, Math.min(cy, ry+rh));
  const dx = cx - tx, dy = cy - ty;
  return (dx*dx + dy*dy) <= cr*cr;
}

/* ------------- main loop ------------- */
let last = performance.now();
function loop(now){
  const dt = Math.min(50, now-last); last = now;

  // bg
  ctx.clearRect(0,0,cv.width,cv.height);

  // clouds parallax
  clouds.forEach(c=>{
    c.x -= c.s;
    if(c.x < -200){ c.x = cv.width+40; c.y = Math.random()*cv.height*0.45+cv.height*0.1; c.s = 0.3+Math.random()*0.6; }
    ctx.drawImage(cloudImg, c.x, c.y);
  });

  if(state==='play'){
    // physics with variable jump height & coyote/buffer
    player.buffer = Math.max(0, player.buffer - dt);
    player.coyote = Math.max(0, player.coyote - dt);

    // floor
    const floorY = cv.height - 70;

    // gravity (lighter while holding on upward motion)
    let g = player.gravity;
    if(player.vy < 0 && holdingJump) g *= 0.35;
    player.vy += g;
    player.y  += player.vy;

    // land on floor
    if(player.y + player.h >= floorY){
      player.y = floorY - player.h;
      player.vy = 0;
      player.grounded = true;
      player.canDouble = true;
      player.coyote = player.coyoteMs;
    } else {
      player.grounded = false;
    }

    // land on platforms (from above)
    for(const p of platforms){
      // treat as solid only if moving downward and feet cross p.y
      const wasAbove = (player.y + player.h - player.vy) <= p.y;
      const withinX = player.x + player.w*0.5 > p.x && player.x + player.w*0.5 < p.x+p.w;
      if(player.vy >= 0 && wasAbove && withinX && player.y + player.h >= p.y && player.y + player.h <= p.y+22){
        player.y = p.y - player.h;
        player.vy = 0;
        player.grounded = true;
        player.canDouble = true;
        player.coyote = player.coyoteMs;
      }
    }

    // apply buffered/coyote jump
    if(player.buffer>0 && (player.grounded || player.coyote>0)){
      player.vy = player.jump;
      player.buffer = 0;
      player.coyote = 0;
      player.grounded = false;
    } else if(player.buffer>0 && player.canDouble && !player.grounded){
      // double jump
      player.vy = player.jump * 0.9;
      player.canDouble = false;
      player.buffer = 0;
    }

    // spawn cadence + difficulty
    tRing += dt; tFire += dt; tDiff += dt;
    if(tRing > 1200){ spawnRing(); tRing = 0; }
    if(tFire > 1700){ spawnFire(); tFire = 0; }
    if(tDiff > 20000){ speedScale = Math.min(2.2, speedScale+0.15); tDiff = 0; }

    // move & draw platforms
    for(let i=platforms.length-1;i>=0;i--){
      const p = platforms[i]; p.x -= p.s;
      // draw cloud platform
      ctx.drawImage(cloudImg, p.x-20, p.y-32);
      // cull
      if(p.x + p.w < -50) platforms.splice(i,1);
    }

    // rings
    for(let i=rings.length-1;i>=0;i--){
      const r = rings[i]; r.x -= r.s;
      ctx.drawImage(ringImg, r.x-22, r.y-22);
      if(rectCircle(player.x,player.y,player.w,player.h, r.x,r.y,r.r)){
        rings.splice(i,1); score += 10; scoreEl.textContent = score;
      } else if(r.x + r.r < -10){ rings.splice(i,1); }
    }

    // fireballs
    for(let i=fires.length-1;i>=0;i--){
      const f = fires[i]; f.x -= f.s;
      // flicker by slight scale
      const scale = 0.9 + 0.2*Math.sin((now+f.t)/120);
      ctx.save();
      ctx.translate(f.x, f.y);
      ctx.scale(scale, scale);
      ctx.drawImage(fireImg, -22, -22);
      ctx.restore();

      if(rectCircle(player.x,player.y,player.w,player.h, f.x,f.y,f.r)){
        endGame();
      } else if(f.x + f.r < -10){ fires.splice(i,1); }
    }
  }

  // player
  ctx.drawImage(unicornImg, player.x, player.y);

  // ground strip
  const groundY = cv.height - 70;
  ctx.fillStyle = '#e9f7ff';
  ctx.fillRect(0, groundY, cv.width, cv.height-groundY);

  if(state!=='over') requestAnimationFrame(loop);
}

function endGame(){
  state = 'over';
  finalScoreEl.textContent = score;
  overOv.style.display = 'grid';
}

/* ------------- boot ------------- */
Promise.all([svgToImg(unicornSVG), svgToImg(fireballSVG), svgToImg(ringSVG), svgToImg(cloudSVG)])
.then(([u,f,r,c])=>{
  unicornImg = u; fireImg = f; ringImg = r; cloudImg = c;
  // start screen shown by default
  requestAnimationFrame(loop);
});

document.getElementById('startBtn').onclick = ()=>{
  state = 'play';
  score = 0; scoreEl.textContent = '0';
  startOv.style.display = 'none';
  // ensure initial platform or two
  platforms.push({x: cv.width*0.55, y: cv.height*0.62, w: 160, h: 18, s: 2.2});
  platforms.push({x: cv.width*0.85, y: cv.height*0.55, w: 140, h: 18, s: 2.0});
};

document.getElementById('restartBtn').onclick = ()=>{ location.reload(); };
</script>
</body>
</html>
